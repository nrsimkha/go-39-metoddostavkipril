name: go-39

on:
  push
  
env:
  PUBLIC_REGISTRY_HOST: docker.io
  PUBLIC_REGISTRY_OWNER: nrsimkha
  PUBLIC_REGISTRY_APP_NAME: module-39

jobs:
  build:
    runs-on: ubuntu-latest    
    steps:
      - uses: actions/setup-go@v5
        with:
          go-version: '1.15.x'
      - run: CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ${PUBLIC_REGISTRY_APP_NAME}

  test:
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - run: echo "No tests!"

  lint:
    if: always()
    runs-on: ubuntu-latest
    needs: [build]
    steps:
      - uses: actions/setup-go@v5
        with:
          go-version: '1.15.x'
      - run: curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.41.1
      - run: golangci-lint --version
      - run: golangci-lint run
  
  image:
    container: docker:latest
    runs-on: ubuntu-latest
    needs: [build,test,lint]
    if: github.ref == 'refs/heads/master'
    services:
      docker:
        image: docker:dind
    steps:
      - uses: actions/setup-go@v5
        with:
          go-version: '1.15.x'
      - run: echo "No build image commands!!!"     
      



